DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'DAL.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201711051533452_change5'
BEGIN
    CREATE TABLE [dbo].[Albums] (
        [Id] [int] NOT NULL IDENTITY,
        [name] [nvarchar](max) NOT NULL,
        [releasedate] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.Albums] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [genreName] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[People] (
        [Id] [int] NOT NULL IDENTITY,
        [name] [nvarchar](max) NOT NULL,
        [dayOfBirth] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.People] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Roles] (
        [Id] [int] NOT NULL IDENTITY,
        [role] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Roles] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Track_Album] (
        [Id] [int] NOT NULL IDENTITY,
        [TrackSequence] [int] NOT NULL,
        [TrackId] [int] NOT NULL,
        [AlbumId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Track_Album] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[Track_Album]([TrackId])
    CREATE INDEX [IX_AlbumId] ON [dbo].[Track_Album]([AlbumId])
    CREATE TABLE [dbo].[Tracks] (
        [Id] [int] NOT NULL IDENTITY,
        [name] [nvarchar](max) NOT NULL,
        [Extention] [nvarchar](max),
        [length] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Tracks] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Track_Genre] (
        [Id] [int] NOT NULL IDENTITY,
        [TrackId] [int] NOT NULL,
        [GenreID] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Track_Genre] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_TrackId] ON [dbo].[Track_Genre]([TrackId])
    CREATE INDEX [IX_GenreID] ON [dbo].[Track_Genre]([GenreID])
    CREATE TABLE [dbo].[Track_Person_Role] (
        [Id] [int] NOT NULL IDENTITY,
        [PersonId] [int] NOT NULL,
        [TrackId] [int] NOT NULL,
        [RoleId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Track_Person_Role] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_PersonId] ON [dbo].[Track_Person_Role]([PersonId])
    CREATE INDEX [IX_TrackId] ON [dbo].[Track_Person_Role]([TrackId])
    CREATE INDEX [IX_RoleId] ON [dbo].[Track_Person_Role]([RoleId])
    ALTER TABLE [dbo].[Track_Album] ADD CONSTRAINT [FK_dbo.Track_Album_dbo.Albums_AlbumId] FOREIGN KEY ([AlbumId]) REFERENCES [dbo].[Albums] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Album] ADD CONSTRAINT [FK_dbo.Track_Album_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Genre] ADD CONSTRAINT [FK_dbo.Track_Genre_dbo.Genres_GenreID] FOREIGN KEY ([GenreID]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Genre] ADD CONSTRAINT [FK_dbo.Track_Genre_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Person_Role] ADD CONSTRAINT [FK_dbo.Track_Person_Role_dbo.People_PersonId] FOREIGN KEY ([PersonId]) REFERENCES [dbo].[People] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Person_Role] ADD CONSTRAINT [FK_dbo.Track_Person_Role_dbo.Roles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[Roles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Track_Person_Role] ADD CONSTRAINT [FK_dbo.Track_Person_Role_dbo.Tracks_TrackId] FOREIGN KEY ([TrackId]) REFERENCES [dbo].[Tracks] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201711051533452_change5', N'DAL.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B6FA4C8157E8F94FF80784A22AFB13D2F89D5BD2B6FDB5E59195F34ED59E5CD2A43751B2D14BD50586DADF2CBF2909F94BF908202BAAE50D0D060CB1A4DAB1BEA5C38E7AB53A72E07FFEF3FFF9DFDB40D03EB15C6891FA1B97D7A7C625B10B991E7A3F5DC4EF1EA87BFDB3FFDF8E73FCDAEBC706BFD5AB6FB92B523942899DB2F186FCE1D27715F600892E3D077E3288956F8D88D42077891737672F20FE7F4D48184854D7859D6EC5B8AB01FC2FC07F9B988900B373805C16DE4C12029AE933BCB9CAB750742986C800BE7F6E5C5D763F2DFB62E021F10F14B18AC6C0B201461808972E7DF13B8C47184D6CB0DB90082C7B70D24ED56204860A1F4F9AEB9A9FE276799FECE8EB064E5A6098EC2960C4FBF14067144F24E66B52B8311935D11D3E2B7ECA973B3CDED8BE0390D6D4B9474BE08E2AC153569DEE8C8A2F63FAA3C4D0091FD3BB2166980D318CE114C710C8223EB217D0E7CF79FF0ED31FA0DA2394A838055832842EE7117C8A58738DAC018BF7D83AB42B91BCFB61C9ECE11092B3286866A7E83F09733DBBA23C2C173002B2F334FB9C4510C7F8108C60043EF01600C6394F180B99D24E9822C443E4B690456A45BD8D62DD87E85688D5FE636F96A5BD7FE167AE5954283EFC827BD8810E138850A0DEBA5C6308020811E51B9147E49BE3FFA6113AF99B3F37F2D2A884962D8848ABCD1272A2459EBCC2E77078086B13B1F886BB2E851EF4FDAEAD3A113E9E61E78BB5FFDECC7F865A85EFE2D0A1A3B79D6E61312720CCE4D3791EEFD1803F7B727A3919C69FAE95549566E9D25FC3D25592E6C126BC0AA59F77A26B99F5A33B903AFFE3AB7878A9D6D7D83417E3779F1373445666151E2E83A8EC2ACF373F02A3E97511AE7068A742D1E41BC86D85CB59C43A36A452BB56AF47B9D6AF4BB4AB5765DCDA8937D76AF898CA3575B9CA997E53F7B8BAE9714E4B46D7A6BCB106F9496334D3F31384C5CCE8D7B73D9575C5E53B76A835F2EEEA96825063FE6A626F8B12DFA8ECB94B7262E33376B55EB2B2E3FD119CC93495E2B117CF6154916B5CEBE9DA5971E9779A8BF44A89C0F6B61CDE0E2A96C2CA25B6EA301B9A261DB6E48116DA42E6D5AA76CFED1AC6AFED177BC600568A286D4C440D7F611E4224922D7CF95946751450ECC3FF315F2ACC68498261842DE4A520D1241FC0D89194493B9FD37C99E75BCCBA762782BB99EDA62C4B947973080185A172E5D7C5E80C4059EDC51888D3CFE0A095230CEA2040816C48D24ECF908CB11CD47AEBF014193EE02A16130CC14AB4488772EE106A22C8E35F9C4447635CF9215A8E408166B32D0CC6110660E3CDA274CC021748D5E81C7772791F7B481C7E97E60E0713E31915D8D8D23028FCD2EEBC1A14C3545E0157394B6C05325A90C6F25D7A9004FA1FBC180A7F08989EC6A06333AF04C229E7222D12BF0DE67C453E87E60E0BDCB88A7C8EEEB315297EA8B30E4E6A06DC15833556004953392698252FF0C07C3A6DE5F262AECA6BD13C1688E2573E0F0F3BBC1F0C9CD0F19312ACE53C426ABFF28C864FD64A240B9063211549A0CDC3573F9C170F93E8772ED138C02CD490FEB744187D0604201E34283DB34F1DDEC22DC62C5E2EFF70416EBBF49B19923222A63BA84985D12486C6BB77AC4AFBD4880E4C9F3EC48455E64A90DE4D4172AFA72EC6F60907951454EBB570331B78220B1E0EE9A7052E951F44523450A9369143133A822C668F8716D04AE0C2095D62AADC2B4D36EB08BFDC46479B17A2AC14752A733594F6498956017031CFFBC2D6D51B8B8DE168A41C470C56B4F5BF0A384C8AC3F5B707B773A5B6897600C1761245B283B85E1AA0BC3AC8C62BDDAA20117DA5501C375813D6D71285CA876987426699AAFB69BB14A06AA8978EDA6A80CE76A001BC05C54511363C913A73653A71E0DC5CD9518BEC5303D80911A7A594322DF2A95EFD14EFDF5BE72DFAF4A13AB7B3387D68D1417668EA6C064760B361B1FAD998293E28AB5A4D5268B1F96ED2B3242CAC37113456146A56D250947315843E12E114D34BDF6E3045F020C9E41B6F9BDF042A91997146B32A4521497F7CA4E2B93A5B279F69D92144537C7CABC6667B56BF2206136E9C84F2588D9874C6765053E2000B1E204C4220AD210E9273F7A6A7A068DA5A757CC3970E5172C23EE86CC6FE6088690664A9291A5F926EF3223871663781787FEA24A480C1CAAA11BC6A14CB505CB84B93C1957948362175FA8C77D0367E808A7DABDD8B207960F7B7D321EA5E377177FAA5213036FAAC986F125AD71E0229C72441FCDFAECBCAF8B0F6AE80D5C514B3D8C477291BBFA04969170AB254F512DED729E9E4F758686E5A33D58332E66BA7559659E6C0A94F7138099F3F22C1BE6B239AFF2443CCBA8BC362D483C2993961661A46BB2544B3D6018E9A1CB578748583EDA932523FB979D9476F7720D17635FD7F218C6E3BB2D6D96877EA37B78EC949B992C1BDD06E7C0C891960AC42695F46AC940581A9815D3F4E6175448F376DAC4B688795E7D2F9BB32FDF120CC3E3ACC1F1F2F76011F8E479770D6E01F25730C1B4F4C03E3B393D135E77319D574F3849E2058A650EE9FD13BCB30E503CE167266D2C8F6859A440475A2A00BD82D87D01F15F42B0FD6B1FAF78C8BEE3DE5FF1F0310C2FBD71A18DF5DBBE45E16398AC3FACCAEF29E81BAA8AF34FEFD5EC74063D2048B5B3D2776B326166CB48DAAF102D67219D13B9411EDCCEED3F729A73EBE65F4F05D991751F93E1F7DC3AB1FEBD6F21BFA9E882AC85E89685EC1F0321FDC532A9565CCBAE7D3D7833643B55837F0C178ED83785626E53D105D9607D533F4D7CB74EDECD37DB99BAA4DBCBCD23228C2F5E36954CA97AC0D73EA5AEC5A1AA83D69E2A0F6C752F71EC742857B7293064F9E0C72B553DF0F1EB290047B749303A700E79427B9F52D3E2B8DE416B3F954701BB971876028E6EFF60C8F2BD8F572A3A72C4190338078E38E6C09942C4693A3ACB78B03C857BD842CB9AD390FB1649754293F69CD1F055471FB0385372E3E0C59153C393B1634741D3FB2BA91C79801B1B4E071EECDAE2E990439EB0695D68201F0C171DAAA873D49739D2EDE9B9ED3D47C4DF74E941532D2672D695ED15D7559C35F54622E772589658973754BC1F60B431A87DD4D406D2CB2ABEEA120E912D37F194B873775542B80626A2F425975AF6A60F61548EA97F8841EB35F562C72FEBE49CCF143E18562C9A563C4EA66A535678328FDA635126D71B98EA07C37A43D37AC5C9D45C76F2EA611E75B0924A7EBC61AB2A5A55B7B5AB949B56A9A4A47FFBE2BE111EBF01F6AD8B203B817F0813B4A86E948F26929C93F90B5B24F34DFCF58E45F6F7B61074B96CB36A7383565199F50A1A954D84BDAF5B88814752D18B18FB2BE06272DB854992BF80FD5710A4A4C955F80CBD1B749FE24D8AC923C3F039E0DE4D9C25CF75F2F3124E5EE7D9FD267FFF6C1F8F40D4F4B3234DF7E8E7D40FBC4AEF6BC5169C86459695171BA9992F71B6A1BA7EAB38DD45C8905161BE6A32F108C34D409825F768095E6117DDBE27F02B5C03F7AD3C61AA67D2EC08DEECB34B1FAC631026058F1D3DF94930EC85DB1FFF0FEF60C47D686E0000 , N'6.1.3-40302')
END

